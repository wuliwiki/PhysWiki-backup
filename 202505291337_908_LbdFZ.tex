% 洛必达法则（综述）
% license CCBYSA3
% type Wiki

本文根据 CC-BY-SA 协议转载翻译自维基百科 \href{https://en.wikipedia.org/wiki/L\%27H\%C3\%B4pital\%27s_rule}{相关文章}。

洛必达法则（/ˌloʊpiːˈtɑːl/，音似“洛-皮-塔尔”，法语：[lopital]），也称为伯努利法则，是一个数学定理，用于通过求导的方法来求解不定式形式的极限。该法则的应用（或重复应用）通常可以将一个不定式转化为一个可以通过代入法轻松求解的表达式。此定理以17世纪法国数学家纪尧姆·德·洛必达命名。尽管该法则通常归功于洛必达，但实际上这个定理是由瑞士数学家约翰·伯努利于1694年首次介绍给他的。

洛必达法则陈述如下：

设函数 $f$ 和 $g$ 在某开区间 $I$ 上定义，并且在 $I \setminus \{c\}$ 上可导，其中 $c$ 是区间 $I$ 的一个（可能是无穷的）聚点。如果满足：
$$
\lim_{x \to c} f(x) = \lim_{x \to c} g(x) = 0 \quad \text{或} \quad \pm \infty~
$$
且对于所有 $x \in I \setminus \{c\}$，都有 $g'(x) \ne 0$，并且
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)} \quad \text{存在}~
$$
那么就有：
$$
\lim_{x \to c} \frac{f(x)}{g(x)} = \lim_{x \to c} \frac{f'(x)}{g'(x)}~
$$
该法则通过对分子与分母分别求导，常常可以简化商的表达式，或将其转化为一个可直接用连续性求解的极限形式。
\subsection{历史}
纪尧姆·德·洛必达（Guillaume de l'Hôpital，也写作 l'Hospital\(^\text{[a]}\)）于1696年在其著作《Analyse des Infiniment Petits pour l'Intelligence des Lignes Courbes》（直译为《为理解曲线而作的无穷小分析》）中发表了这一法则，该书是第一本关于微分法的教科书。\(^\text{[1][b]}\)然而，人们普遍认为，这一法则实际上是由瑞士数学家约翰·伯努利发现的。\(^\text{[3]}\)
\subsection{通用形式}

洛必达法则的通用形式涵盖了多种情况。设 $c$ 和 $L$ 为扩展实数，即实数以及正无穷与负无穷。设 $I$ 为包含 $c$ 的开区间（用于双侧极限），或者以 $c$ 为端点的开区间（用于单侧极限，或 $c$ 为无穷时的极限）。在 $I \setminus \{c\}$ 上，假设实值函数 $f$ 和 $g$ 可导，且满足：$g'(x) \ne 0$同时还假设：
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)} = L~
$$
其中 $L$ 可以是有限数，也可以是无穷。

如果满足以下任一条件：
$$
\lim_{x \to c} f(x) = \lim_{x \to c} g(x) = 0~
$$
或
$$
\lim_{x \to c} |f(x)| = \lim_{x \to c} |g(x)| = \infty ~
$$
那么：
$$
\lim_{x \to c} \frac{f(x)}{g(x)} = L~
$$
虽然上述表达中我们始终使用的是 $x \to c$，但这些极限也可以是单侧极限（例如 $x \to c^+$ 或 $x \to c^-$），当 $c$ 是区间 $I$ 的有限端点时尤为如此。

在第二种情况下，并不要求 $f$ 必须发散到无穷大；实际上，仅需满足：$\lim_{x \to c} |g(x)| = \infty$这一条件就已足够。文献中通常会出现关于 $g'(x) \ne 0$ 的假设，但有些作者通过加入其他可以推出 $g'(x) \ne 0$ 的条件，来绕过这一要求。例如，\(^\text{[4]}\)有人要求在定义极限
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)} = L~
$$
时，函数 $\frac{f'(x)}{g'(x)}$ 必须在区间 $I \setminus \{c\}$ 上处处有定义。\(^\text{[c]}\)另一种方法是\(^\text{[5]}\)，要求 $f$ 和 $g$ 在包含 $c$ 的整个区间上都可导。
\subsection{条件的必要性：反例说明}
罗必达法则的四个条件都是不可或缺的：
\begin{enumerate}
\item 不定型的存在：
   $$
   \lim_{x \to c} f(x) = \lim_{x \to c} g(x) = 0 \quad \text{或} \quad \pm \infty~
   $$
\item 函数可导性：
   函数 $f(x)$ 和 $g(x)$ 在开区间 $\mathcal{I}$（除去可能的极限点 $c$）上可导；
\item 分母导数不为零：对于 $\mathcal{I}$ 中所有 $x \ne c$，有 $g'(x) \ne 0$；
\item 导数之比的极限存在：
   $$
   \lim_{x \to c} \frac{f'(x)}{g'(x)} \quad \text{存在}~
   $$
\end{enumerate}
如果上述任意一个条件不成立，罗必达法则一般就不适用，其结论在某些情况下可能是错误的。
\subsubsection{1. 形式不是不定式}
第一个条件（形式为不定式）的必要性可以通过以下反例说明：设函数$f(x) = x + 1$，$g(x) = 2x + 1$，并考虑极限 $x \to 1$。

该反例不满足第一个条件，因为
$$
\lim_{x \to 1} f(x) = \lim_{x \to 1} (x + 1) = 2 \neq 0~
$$
$$
\lim_{x \to 1} g(x) = \lim_{x \to 1} (2x + 1) = 3 \neq 0~
$$
这说明极限形式不是不定式。

函数 $f(x)$ 与 $g(x)$ **满足第二与第三个条件**，即在开区间内可导，且 $g'(x) \ne 0$。
它们也满足第四个条件，因为：
$$
\lim_{x \to 1} \frac{f'(x)}{g'(x)} = \lim_{x \to 1} \frac{(x + 1)'}{(2x + 1)'} =\lim_{x \to 1} \frac{1}{2} =\frac{1}{2}~
$$
然而，结论不成立，因为
$$
\lim_{x \to 1} \frac{f(x)}{g(x)} = \lim_{x \to 1} \frac{x + 1}{2x + 1} =\frac{\lim_{x \to 1}(x+1)}{\lim_{x \to 1}(2x+1)}= \frac{2}{3} \ne \frac{1}{2}~
$$
这说明如果极限形式不是不定式（即使其它条件都满足），罗必达法则的结论也不一定成立。
\subsubsection{2. 函数的可导性}
函数的可导性是罗必达法则的一个必要条件，因为如果函数在某点不可导，就无法保证该点的导数存在。而开区间 $\mathcal{I}$ 的前提是由柯西中值定理的假设决定的。值得注意的是，尽管函数可能在极限点 $c$ 不可导，罗必达法则仍然可能适用，这是因为它只要求函数在趋近于 $c$ 的过程中可导，而不要求函数在 $c$ 点本身可导。

例如，设
$$
f(x) = \begin{cases}
\sin x, & x \ne 0 \\
1, & x = 0
\end{cases}
,\quad g(x) = x,\quad c = 0~
$$
在这个例子中，函数 $f(x)$ 在 $x = 0$ 不可导，但它在 $x \ne 0$ 的所有点都可导，因此：$\lim_{x \to 0} \frac{f(x)}{g(x)} = \frac{0}{0}$，为不定式；
尽管 $f(x)$ 在 $x = 0$ 不可导，但 $\lim_{x \to 0} \frac{f'(x)}{g'(x)}$ 存在。

因此，罗必达法则仍然成立，即：
$$
\lim_{x \to 0} \frac{f(x)}{g(x)} = \lim_{x \to 0} \frac{f'(x)}{g'(x)}~
$$
这说明只要函数在趋近于 $c$ 的过程中可导（即在 $\mathcal{I} \setminus \{c\}$ 上可导），即便在 $c$ 点本身不可导，罗必达法则仍然适用。
\subsubsection{3. 分母导数不为零的必要性}
分母函数 $g'(x) \neq 0$ 在靠近 $c$ 附近这一条件的必要性，可以通过奥托·斯托尔茨（Otto Stolz）给出的以下反例看出。[6] 设$f(x) = x + \sin x \cos x$
$g(x) = f(x) \cdot e^{\sin x}$那么，当 $x \to \infty$ 时，$\frac{f(x)}{g(x)}$ 并不存在极限。

然而，我们有：
$$
\frac{f'(x)}{g'(x)} = \frac{2\cos^2 x}{(2\cos^2 x)e^{\sin x} + (x + \sin x \cos x)e^{\sin x} \cos x}
= \frac{2\cos x}{2\cos x + x + \sin x \cos x} \cdot e^{-\sin x}~
$$
该表达式在 $x \to \infty$ 时趋于 0，尽管在无穷多个点处它是未定义的。这一类型的更多反例可见于小拉尔夫·P·博阿斯（Ralph P. Boas Jr.）的研究中。[7]
\subsubsection{4. 导数比值极限不存在}
要求极限
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)}~
$$
存在是必要的；如果这个极限不存在，那么原始极限
$$
\lim_{x \to c} \frac{f(x)}{g(x)}~
$$
却可能仍然存在。事实上，当 $x$ 趋近于 $c$ 时，函数 $f$ 或 $g$ 可能出现振幅很小但斜率极大的频繁震荡。这些震荡不会影响
$$
\lim_{x \to c} \frac{f(x)}{g(x)}~
$$
的存在性，但却会阻止
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)}~
$$
的收敛。

例如，设$f(x) = x + \sin(x),\quad g(x) = x,\quad c = \infty$那么有
$$
\frac{f'(x)}{g'(x)} = \frac{1 + \cos(x)}{1}~
$$
由于余弦函数在 $1$ 和 $-1$ 之间无限振荡，因此该比值（$\frac{f'(x)}{g'(x)}$）并不趋于某个极限。但原始函数之比（$\frac{f(x)}{g(x)}$）确实趋于某个极限，因为相对于 $g$，函数 $f$ 的振荡幅度变得越来越小：
$$
\lim_{x \to \infty} \frac{f(x)}{g(x)} = \lim_{x \to \infty} \left( \frac{x + \sin(x)}{x} \right) = \lim_{x \to \infty} \left( 1 + \frac{\sin(x)}{x} \right) = 1 + 0 = 1~
$$
在这种情况下，我们所能断定的只有：
$$
\liminf_{x \to c} \frac{f'(x)}{g'(x)} \leq \liminf_{x \to c} \frac{f(x)}{g(x)} \leq \limsup_{x \to c} \frac{f(x)}{g(x)} \leq \limsup_{x \to c} \frac{f'(x)}{g'(x)}~
$$
也就是说，如果 $\frac{f}{g}$ 的极限存在，那么它一定落在 $\frac{f'}{g'}$ 的下确界与上确界之间。在本例中，1 的确位于 0 和 2 之间。

另外还要注意，按照洛必达法则的逆否命题，如果
$$
\lim_{x \to c} \frac{f(x)}{g(x)}~
$$
不存在，那么
$$
\lim_{x \to c} \frac{f'(x)}{g'(x)}~
$$
也一定不存在。
\subsection{示例}
在以下计算中，我们用符号$\stackrel{\mathrm{H}}{=}$表示每一次应用洛必达法则。

\begin{itemize}
\item 下面是一个涉及指数函数的基本例子，在 $x = 0$ 处属于不定型 $\frac{0}{0}$：
$$
\lim_{x \to 0} \frac{e^x - 1}{x^2 + x}
\stackrel{\mathrm{H}}{=}
\lim_{x \to 0} \frac{\frac{d}{dx}(e^x - 1)}{\frac{d}{dx}(x^2 + x)}
=
\lim_{x \to 0} \frac{e^x}{2x + 1}
= 1~
$$
\item 这是一个更复杂的不定型 $\frac{0}{0}$ 的例子。仅应用一次洛必达法则仍然得到不定型。在这种情况下，可以连续应用三次法则来求极限：
$$
\begin{aligned}
\lim_{x \to 0} \frac{2\sin(x) - \sin(2x)}{x - \sin(x)}
&\stackrel{\mathrm{H}}{=}
\lim_{x \to 0} \frac{2\cos(x) - 2\cos(2x)}{1 - \cos(x)} \\
&\stackrel{\mathrm{H}}{=}
\lim_{x \to 0} \frac{-2\sin(x) + 4\sin(2x)}{\sin(x)} \\
&\stackrel{\mathrm{H}}{=}
\lim_{x \to 0} \frac{-2\cos(x) + 8\cos(2x)}{\cos(x)} =
\frac{-2 + 8}{1} = 6
\end{aligned}~
$$
\item 以下是一个涉及不定型 $\frac{\infty}{\infty}$ 的例子：
$$
\lim_{x \to \infty} x^n \cdot e^{-x}
=
\lim_{x \to \infty} \frac{x^n}{e^x}
\stackrel{\mathrm{H}}{=}
\lim_{x \to \infty} \frac{n x^{n-1}}{e^x}
= n \cdot \lim_{x \to \infty} \frac{x^{n-1}}{e^x}~
$$
不断应用洛必达法则，直到幂降为零（如果 $n$ 是整数）或负数（如果 $n$ 是分数），即可得出极限为 0。
\item 下面是一个涉及不定型 $0 \cdot \infty$ 的例子（详见下文），可将其重写为不定型 $\frac{\infty}{\infty}$：
$$
\lim_{x \to 0^+} x \ln x
=
\lim_{x \to 0^+} \frac{\ln x}{\frac{1}{x}}
\stackrel{\mathrm{H}}{=}
\lim_{x \to 0^+} \frac{\frac{1}{x}}{-\frac{1}{x^2}}
=
\lim_{x \to 0^+} (-x) = 0~
$$
\item 还有一个例子涉及贷款偿还公式和不定型 $\frac{0}{0}$。设 $P$ 为贷款本金，$r$ 为每期利率，$n$ 为期数。当 $r = 0$ 时，每期还款金额为 $\frac{P}{n}$（因为只还本金）；这一结果与利率不为零时的公式一致：
$$
\lim_{r \to 0} \frac{Pr(1+r)^n}{(1+r)^n - 1}
\stackrel{\mathrm{H}}{=}
P \cdot \lim_{r \to 0} \frac{(1+r)^n + rn(1+r)^{n-1}}{n(1+r)^{n-1}} = \frac{P}{n}~
$$
\item 洛必达法则还可以用于证明以下定理：如果函数 $f$ 在 $x$ 的邻域内是两次可导的，且其二阶导数在该邻域内连续，则有：
$$
\begin{aligned}
\lim_{h \to 0} \frac{f(x+h) + f(x-h) - 2f(x)}{h^2}
&= \lim_{h \to 0} \frac{f'(x+h) - f'(x-h)}{2h}\\
&= \lim_{h \to 0} \frac{f''(x+h) + f''(x-h)}{2}\\
&= f''(x)
\end{aligned}~
$$
\item 有时候，洛必达法则会被巧妙地应用。例如，设 $f(x) + f'(x)$ 在 $x \to \infty$ 时收敛，且 $e^x \cdot f(x)$ 收敛到正无穷或负无穷。那么我们有：
$$
\lim_{x \to \infty} f(x)
= \lim_{x \to \infty} \frac{e^x \cdot f(x)}{e^x}
\stackrel{\mathrm{H}}{=}
\lim_{x \to \infty} \frac{e^x \cdot (f(x) + f'(x))}{e^x}
= \lim_{x \to \infty} (f(x) + f'(x))~
$$
因此，$\lim_{x \to \infty} f(x)$ 存在，且$\lim_{x \to \infty} f'(x) = 0$（即使不假设 $e^x \cdot f(x)$ 收敛到正无穷或负无穷，这个结论仍然成立，但证明将不完整。）
\end{itemize}
\subsection{复杂情况}
有时，洛必达法则在有限次数的步骤内并不能直接简化为明显的极限，除非中间进行了某些简化操作。例如如下情况：
\begin{itemize}
\item 两次应用洛必达法则可能会回到最初要计算的表达式：
$$
\lim_{x \to \infty} \frac{e^x + e^{-x}}{e^x - e^{-x}} 
\stackrel{H}{=} 
\lim_{x \to \infty} \frac{e^x - e^{-x}}{e^x + e^{-x}} 
\stackrel{H}{=} 
\lim_{x \to \infty} \frac{e^x + e^{-x}}{e^x - e^{-x}} 
\stackrel{H}{=} \cdots~
$$
这种情况可以通过变量替换 $y = e^x$ 来处理，因为当 $x \to \infty$ 时，$y \to \infty$。用这个替换之后，该问题可通过一次洛必达法则解决：
$$
\lim_{x \to \infty} \frac{e^x + e^{-x}}{e^x - e^{-x}} 
= \lim_{y \to \infty} \frac{y + y^{-1}}{y - y^{-1}} 
\stackrel{H}{=} 
\lim_{y \to \infty} \frac{1 - y^{-2}}{1 + y^{-2}} 
= \frac{1}{1} = 1~
$$
另一种方法是同时将分子和分母乘以 $e^x$，这样就可以立即应用洛必达法则\(^\text{[8]}\)：
$$
\lim_{x \to \infty} \frac{e^x + e^{-x}}{e^x - e^{-x}} 
= \lim_{x \to \infty} \frac{e^{2x} + 1}{e^{2x} - 1} 
\stackrel{H}{=} 
\lim_{x \to \infty} \frac{2e^{2x}}{2e^{2x}} = 1~
$$
\item 有时，即使不出现循环，也可能需要任意多次应用洛必达法则都得不到结果：
$$
\lim_{x \to \infty} \frac{x^{\frac{1}{2}} + x^{-\frac{1}{2}}}{x^{\frac{1}{2}} - x^{-\frac{1}{2}}}
\stackrel{H}{=}
\lim_{x \to \infty} \frac{\frac{1}{2}x^{-\frac{1}{2}} - \frac{1}{2}x^{-\frac{3}{2}}}{\frac{1}{2}x^{-\frac{1}{2}} + \frac{1}{2}x^{-\frac{3}{2}}}
\stackrel{H}{=}
\lim_{x \to \infty} \frac{-\frac{1}{4}x^{-\frac{3}{2}} + \frac{3}{4}x^{-\frac{5}{2}}}{-\frac{1}{4}x^{-\frac{3}{2}} - \frac{3}{4}x^{-\frac{5}{2}}}
\stackrel{H}{=} \cdots~
$$
这种情况也可以通过变量替换来处理，例如设 $y = \sqrt{x}$：
$$
\lim_{x \to \infty} \frac{x^{\frac{1}{2}} + x^{-\frac{1}{2}}}{x^{\frac{1}{2}} - x^{-\frac{1}{2}}}
= \lim_{y \to \infty} \frac{y + y^{-1}}{y - y^{-1}}
\stackrel{H}{=}
\lim_{y \to \infty} \frac{1 - y^{-2}}{1 + y^{-2}} = \frac{1}{1} = 1~
$$
另一种方法是，在应用洛必达法则前，先将分子和分母都乘以 $x^{1/2}$：
$$
\lim_{x \to \infty} \frac{x^{\frac{1}{2}} + x^{-\frac{1}{2}}}{x^{\frac{1}{2}} - x^{-\frac{1}{2}}}
= \lim_{x \to \infty} \frac{x + 1}{x - 1}
\stackrel{H}{=}
\lim_{x \to \infty} \frac{1}{1} = 1~
$$
\end{itemize}
一个常见的逻辑谬误是使用洛必达法则通过计算差商的极限来证明某个导数的值。由于应用洛必达法则本身就需要知道相关函数的导数，这种做法实际上构成了循环论证或预设前提（即假设了需要证明的内容）。例如，考虑以下幂函数的导数公式的证明：
$$
\lim_{h \to 0} \frac{(x+h)^n - x^n}{h} = nx^{n-1}~
$$
若尝试通过洛必达法则来处理，并对 $h$ 求导，确实会得出期望的结果 $nx^{n-1}$，但这一步计算本身就用到了我们正在试图证明的公式，因此并不构成有效的证明。

类似地，为了证明
$$
\lim_{x \to 0} \frac{\sin(x)}{x} = 1~
$$
如果使用洛必达法则，则需要已知 $\sin(x)$ 在 $x=0$ 处的导数，而这实际上等价于计算：
$$
\lim_{h \to 0} \frac{\sin(h)}{h}~
$$
即我们最初需要证明的内容。因此，在这种情况下，有效的证明必须采用其他方法，比如夹逼定理（squeeze theorem）。


