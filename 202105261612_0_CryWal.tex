% 使用数字货币钱包
% 比特币|区块链|数字货币|钱包|纸钱包|手机钱包|私钥|地址

\pentry{数字货币简介\upref{crypto}}
本文简单介绍几种不同类型的数字货币钱包． 本文只从技术上科普数字货币， 不构成任何投资建议， 请严格遵守当地法律和规定．

\subsection{安全注意事项}
\begin{itemize}
\item 建议使用不易中病毒的操作系统操作钱包（如 iOS， Mac， Linux 等），如果你使用 Windows， 确保你的系统和软件都是正版的， 没有正在运行的录屏软件， 并先进行杀毒．
\item 不要在越狱的手机上使用钱包．
\item 不要随身携带存有大量数字货币的钱包， 一旦遇到抢劫对方可能会迫使你转账\footnote{这在黑客技术中俗称 5 dollar wrench attack．}．
\item 使用系统自带的浏览器和输入法（在手机上即使使用第三方输入法， 也不要打开全部权限）进行任何数字货币有关的操作．
\item 复制完敏感信息后， 复制一些其他信息来清空剪切板． 一些软件具有自动读取剪切板的功能．
\end{itemize}

\subsection{比特币地址和私钥}
我们接下来主要以比特币为例讲解， 其他数字货币也大同小异． 比特币最原始的钱包形式就是一个地址和一个私钥． 地址用于接收转账， 而私钥则相当于密码． 一个用于生成地址和私钥的常用网站是 \href{https://www.bitaddress.org/}{bitaddress.org}， 笔者用它生成的一个钱包如下（区分大小写）：
\begin{lstlisting}[language=bash]
地址： 1KwgSiapZKYCeq5Bwh1hHm2c51PQpuxU5c
私钥： L2SqERmStxZaiF8dq8eWF1DXpaSWeH5BAZZxrnnTL6F1NM3vjfsD
\end{lstlisting}

\begin{figure}[ht]
\centering
\includegraphics[width=13cm]{./figures/CryWal_2.png}
\caption{\href{https://www.bitaddress.org/}{bitaddress.org} 生成的纸钱包（用于打印）， 转账时可以扫码} \label{CryWal_fig2}
\end{figure}

注意任何持有私钥的人就等同于持有该地址中的所有比特币， 可以进行任意转账． 比特币一旦被盗几乎不可能追回． 你可以放心把你的地址交给需要给你转账的人， 但为了隐私起见最好不要把地址公开， 因为任何持有地址的人都可以轻易查到其所有交易信息．

事实上， 比特币地址是由其公钥生成的， 而公钥是由其私钥生成的\footnote{这两个过程的算法都是不可逆的， 所以无法从地址或公钥得出私钥}． 所以即使只有你的私钥泄露， 同样会导致比特币被盗．

\subsubsection{使用私钥转账}
如果你需要直接用私钥进行转账， 可以使用 \href{https://blockchain.com}{blockchain.com}． 你需要先用邮箱注册一个账号并在钱包管理页面中导入私钥， 然后转账即可． 一些手机钱包如 green wallet 也有所谓的 sweep 功能（或者叫 redeem private key）， 可以先把私钥中的全部余额转入手机钱包然后再转到其他地址．

\subsection{查询任意地址的信息}
比特币区块链上的所有信息都是公开的， 有许多网站可以搜索并查看任意地址的余额和转账历史． 常用的区块链浏览器（blockchain explorer）网站是 \href{https://blockchain.com}{blockchain.com}， 你可以在上面搜索要查看的地址． 若需要完全确定一笔比特币转账成功， 你需要在 explorer 中看到该转账至少有 6 次确认， 也就是在它后面至少新增了 6 个区块． 手机钱包通常也会显示确认的次数． 对于小额转账， 通常 1 次确认就可以足够放心了． 比特币每个区块的生成时间在 10 分钟左右， 也就是说一次转账需要大约 10 分钟．
\begin{figure}[ht]
\centering
\includegraphics[width=10cm]{./figures/CryWal_1.png}
\caption{你可以查看这个乞丐的收入（图片来自网络）} \label{CryWal_fig1}
\end{figure}

\subsection{钱包类型}
以下大致列出数字货币钱包的类型． 笔者推荐的做法是把需要长期存放的大额比特币直接存在钢板钱包中， 把需要时常转账的大额比特币存在硬件钱包中，把日常小额零花钱存在随身的手机钱包中．
\begin{itemize}
\item \textbf{纸钱包}： 顾名思义， 把地址和私钥写在纸上（也可以使用助记词， 见下文）， 或者打印出来（通常包含二维码）， 并保存到安全的地方（如保险柜或银行）就叫纸钱包． 纸钱包的缺点是使用起来不太方便， 以及可能被烧毁， 泡烂， 褪色等．
\item \textbf{钢板钱包}： 为了克服纸钱包在物理上的脆弱， 市面上也可以买到一些专用的小钢板， 可以在上面以打点或拼图的方式记录地址和私钥（或助记词）． 钢板钱包是长期保存比特币最安全最稳定的方式， 不需要依赖任何第三方数字设备或软件， 无法被骇客盗取， 也可以抵抗常见的自然灾害．
\item \textbf{硬件钱包}： 类似于银行的 U 盾， 通常带有 USB 接口． 地址和私钥信息储存在钱包中， 需要转账时将其插入电脑即可． 原则上该钱包不会把私钥以任何方式传到电脑上， 但这要求你信任开发者． 硬件钱包由于含有电子元件， 在物理上没有钢板钱包坚固．
\item \textbf{非托管钱包}： 非托管软件钱包是软件钱包的一种， 这类钱包可以在电脑或手机上安装， 并把私钥保存在本地． 软件钱包通常自带转账甚至交易功能． 原则上这种钱包不会上传你的私钥， 但这同样要求你信任该开发者． 为了安全起见应该尽量选择口碑好的开源软件钱包， 其源代码经过大量审核， 存在恶意行为或漏洞的风险大大降低． 注意一定要通过官方渠道下载钱包 app．
\item \textbf{托管钱包}： 托管钱包是一种中心化钱包， 可以类比银行或支付宝． 交易所提供的钱包就属于典型的托管钱包， 所有用户的比特币统一存放在交易所持有的若干地址中， 用户通常无法直接获取属于自己的私钥， 但可以获取一些私有地址用于收款． 用户通过交易所的网站或 app， 使用交易所的账号密码登录并进行转账、交易等操作． 交易所钱包的优势有几点： 1. 方便频繁买卖， 2. 同一交易所的用户之间转账可能会实时到账以及免手续费\footnote{这是因为这种情况下交易所并没有真的把比特币从一个地址转到另一个地址， 而只是更改了交易所的用户数据． 只有用户提币时才会真正把币转到用户提供的地址中．}， 3. 交易和转账可以设置短信验证等， 防止密码泄露， 4. 若密码丢失可以通过手机或邮箱等方式找回． 托管钱包是相对来说最不安全的钱包， 一旦交易所倒闭、 服务器出现故障或被骇客攻击就可能直接导致无法取出数字货币． 此前已经有一些交易所被骇客盗窃的案例． 但一些较为正规的交易所（例如 Coinbase）所会把大部分比特币存入离线钱包， 并给流通的币够买全额保险．
\end{itemize}

\subsection{关于隐私}
理论上， 当一个比特币地址生成以后， 如果只单独挖矿或者和随机的地址之间转账， 那么其他人无法得知该地址的持有者是谁． 但如果该地址直接接收交易所的转账， 且交易所中有地址持有者的身份信息， 那么由于区块链上所有的转账都是公开的， 那么这个地址的身份也可能暴露． 类似地， 如果和你交易的人知道你的身份信息， 那么你用于交易的钱包地址的隐私性也可能会降低． 下面我们会看到市面上大部分手机钱包都为此提供了较好的解决方案． 另外也存在一种提供混淆转账功能的托管钱包， 在汇款时会把不同的随机汇款混合到一个地址中后再发向最终地址， 这在一定程度上可以保护转账双方的隐私（但钱包的开发者可能仍然会记录原始信息）． 注意使用有混淆功能的钱包在一些地区可能是违法的， 请严格遵守当地法律．

\subsection{使用助记词}
除了直接生成和保存地址/私钥， 一种更方便的办法是使用助记词． 按照一定的标准算法， 助记词可以以一定的顺序生成任意多个地址和私钥\footnote{注意如果你的私钥是直接生成的， 将无法使用助记词， 但你可以把全部余额转到助记词生成的地址．}． 最常见的助记词标准规范是 \textbf{BIP39 （bitcoin improvement proposal 39）}， 该规范中规定了 2048 个常见且不易混淆的单词用于选取助记词． 常见的助记词个数是 12 个或者 24 个（\autoref{CryWal_tab1} ）， 但 12 个助记词的安全性已经和直接使用比特币私钥几乎相当． 助记词也有中文和其他语言的版本， 中文版本中一个助记词就是一个汉字．
\begin{table}[ht]
\centering
\caption{一组真实的助记词}\label{CryWal_tab1}
\begin{tabular}{|c|c|c|c|}
\hline
1.trend & 2.cage & 3.spell & 4.cycle \\
\hline
5.foster & 6.garbage & 7.upset & 8.peasant \\
\hline
9.mention & 10.purpose & 11.menu & 12.isolate \\
\hline
\end{tabular}
\end{table}

助记词一个最大的优势是方便记忆， 例如可以把助记词串联成几句话， 而且即使发生轻微的拼写错误也容易更正（而私钥一位都不能出错）． 第二是一组助记词可生成任意多个\footnote{这不是数学意义上的无穷， 毕竟钱包地址的总数量是有限的．}私钥和地址． 上述的纸钱包和钢板钱包也可以用于记录助记词而不是地址和私钥．

一个常用助记词生成和转换网页是 \href{https://iancoleman.io/bip39/}{hiancoleman.io/bip39}． 该页面可以随机生成助记词\footnote{声明： 笔者并不了解其随机数生成算法是否足够安全， 请谨慎使用．}， 以及选择不同的算法按顺序生成任意多的地址/私钥， 同一组助记词也可以生成多种数字货币的钱包地址和私钥． 注意该页面可以保存为 html 文件并离线使用， 推荐在安全的设备上离线使用（使用以前断开网线和 wifi）． 由于助记词需要满足一定的限制， 所以用户通常不能逐个选择．

为什么一组助记词可以生成任意多个地址和私钥？ 你可以把这组词理解为随机数生成器的种子， 在一定规则下进行反复迭代就可以生成不同的地址和私钥．

\subsection{使用助记词的手机钱包}
大部分手机钱包无需注册和登录， 而是使用助记词管理地址和私钥， 例如的 \textbf{BRD 钱包（bread wallet）}使用 12 个英文助记词． 在初次使用时， 软件会随机生成助记词并提示你用纸笔将其记下（或使用钢板）， 任何掌握这些助记词的人都等同于拥有其生成地址中的数字货币．

在网页 \href{https://iancoleman.io/bip39/}{hiancoleman.io/bip39} 中， 你可以输入这些助记词并获得一些对应的地址和私钥， 但为了安全起见不建议这么做而是直接使用手机钱包． BRD 的推导算法是 \verb|BIP32|， \textbf{推导路径（derivation path）}是 \verb|m/0'/0|， 你需要在网页中输入这些才会得到正确的地址和私钥（再次提醒注意安全）． 所以在使用类似的手机钱包时， 你不需要担心这个 app 以后是否会被下架， 你唯一需要信任的是它不会偷偷上传你的助记词和私钥．

\subsubsection{手机钱包的隐私策略}
手机钱包为了保证用户隐私， 每次收款时都会根据助记词按顺序生成一个新的地址； 转账时， 除了转指定的数额给目标地址， 也可能会把剩下的余额转到一个新生成的地址． 钱包会定期自动按顺序检查每个地址中的余额， 并显示每个币种的总余额．
