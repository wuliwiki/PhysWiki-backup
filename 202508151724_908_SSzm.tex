% 素数证明书（综合）
% license CCBYSA3
% type Wiki

本文根据 CC-BY-SA 协议转载翻译自维基百科\href{https://en.wikipedia.org/wiki/Primality_certificate}{相关文章}。

在数学和计算机科学中，素数证明书或素性证明是指一种简洁、形式化的证明，用来表明一个数是质数。素数证明书的作用是：无需运行代价高昂或不够可靠的素数判定算法，就能快速验证一个数的素性。这里的“简洁”通常意味着，该证明的规模至多是这个数位数的多项式倍（例如，如果该数有 $b$ 位二进制数位，证明可能大约包含 $b^2$ 位）。

素数证明书直接表明了以下结论：素数判定问题，以及其补问题——整数分解的补集问题——属于 NP 类（即给出解后可在多项式时间内验证的问题类）。这些问题显然也属于 co-NP 类。这是首次有力的证据表明这些问题并不是 NP 完全的，因为如果它们是 NP 完全的，就意味着 NP 是 co-NP 的子集，而这一结论被广泛认为是错误的；事实上，这也是当时首次展示了一个已知属于 NP ∩ co-NP 但不知是否属于 P 类 的问题。

对于其补问题（证明一个数是合数）的证明书，生成方法非常直接：只需给出一个非平凡因子即可。标准的概率型素数判定算法（如 Baillie–PSW 素数判定法、费马素数检验、米勒–拉宾素数检验）在输入是合数的情况下，也会生成“合数证明书”，但对于质数输入则不会生成证明书。
\subsection{普拉特证明书}
素数证明书这一概念最早是由 普拉特证明书引入的，该方法由 Vaughan Pratt 于 1975 年提出\(^\text{[1]}\)。他描述了这种证明书的结构，并证明了它的规模是多项式级的，而且可以在多项式时间内完成验证。普拉特证明书基于卢卡斯素性检验，该检验本质上是费马小定理的逆命题，并附加了一个条件使其成立：

\textbf{卢卡斯定理：}假设存在一个整数 $a$，使得：
\begin{itemize}
\item $a^{n - 1} \equiv 1 \pmod{n}$，
\item 对于 $n - 1$ 的每个质因数 $q$，都有 $a^{(n - 1) / q} \not\equiv 1 \pmod{n}$，
\end{itemize}
那么 $n$ 是质数。

给定这样的 $a$（称为见证，witness）以及 $n - 1$ 的质因数分解，我们可以很快验证上述条件：只需做线性数量的模指数运算（因为任何整数的质因子数不会超过它的比特数）。每次模指数运算可以通过平方乘法在 $O(\log n)$ 次乘法中完成（见大 O 符号）。

即便采用最基础的“学校式”整数乘法，总耗时也只有 $O((\log n)^{4})$；如果使用 David Harvey 和 Joris van der Hoeven提出的目前已知渐进时间最优的乘法算法，则可以将其降低到 $O((\log n)^{3} \log\log n)$，使用软 O 符号则记作 $\tilde{O}((\log n)^{3})$。

然而，如果在给出 $n - 1$ 的“质因数分解”时掺入合数，就有可能欺骗验证者，让其错误地接受一个合数为质数。例如，假设我们声称 $n = 85$ 是质数，并提供 $a = 4$ 以及 $n - 1 = 6 \times 14$ 作为它的“质因数分解”。那么（取 $q = 6$ 和 $q = 14$）：
\begin{itemize}
\item $4$ 与 $85$ 互素；
\item $4^{85-1} \equiv 1 \pmod{85}$；
\item $4^{(85-1)/6} \equiv 16 \pmod{85}$，$4^{(85-1)/14} \equiv 16 \pmod{85}$。
\end{itemize}
这样我们会错误地得出结论：85 是质数。我们当然不希望仅仅为了防止这种欺骗就强迫验证者去重新分解质因数，因此更好的办法是：为 $n - 1$ 的每个质因子也提供相应的素数证明书，这些只是原问题规模更小的实例。如此递归下去，直到遇到一个已知为质数的数（例如2）为止。最终，我们得到一个质数树，每个质数节点都关联着一个见证 $a$。例如，以下是数 229 的完整 普拉特证明书：
\begin{itemize}
\item $229$（$a = 6$，$229 - 1 = 2^2 \times 3 \times 19$）
\item $2$（已知质数）
\item $3$（$a = 2$，$3 - 1 = 2$）
\item $2$（已知质数）
\item $19$（$a = 2$，$19 - 1 = 2 \times 3^2$）
\item $2$（已知质数）
\item $3$（$a = 2$，$3 - 1 = 2$）
\item $2$（已知质数）
\end{itemize}
这个证明树最多包含$4\log_{2}n - 4$个除 2 以外的值，这可以通过一个简单的归纳证明得到（基于 Pratt 定理 2）。该结论对 $3$ 成立；一般情况下，取 $p > 3$，令它在证明树中的子节点为 $p_1, \dots, p_k$。根据归纳假设，以 $p_i$ 为根的子树至多包含$
4\log_{2}p_i - 4$个值，因此整个树包含的值最多为：
$$
1 + \sum_{i=1}^{k} \big(4\log_{2}p_i - 4\big) = -4k + 4\log_{2}(p_1 \cdots p_k) \leq 4\log_{2}p - 4
$$
由于 $k \ge 2$，且 $p_1 \cdots p_k = p - 1$。

因为每个值最多有 $\log n$ 位，所以这也表明该证明书的大小为 $O((\log n)^2)$ 位。

由于除 2 之外的值有 $O(\log n)$ 个，并且每个值的验证最多需要一次模幂运算（而模幂运算是运行时间的主要消耗），因此总运行时间为：$O\big((\log n)^3(\log \log n)(\log \log \log n)\big) \quad \text{或} \quad \tilde{O}((\log n)^3)$这对于计算数论学者通常处理的数值范围来说是相当可行的。

然而，尽管理论上很有用且容易验证，实际为 $n$ 生成一个 Pratt 证明书需要分解 $n - 1$ 以及其他可能很大的数。对于一些特殊的数（如费马质数）来说，这很简单，但对于一般形式的大质数，目前生成 Pratt 证明书的难度远大于直接进行质数判定。
