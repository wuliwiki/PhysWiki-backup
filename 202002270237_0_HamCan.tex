% 哈密顿正则方程
% 哈密顿量|拉格朗日变换|哈密顿正则方程

\pentry{拉格朗日方程\upref{Lagrng}}

\subsection{哈密顿量}
我们定义一个系统的\textbf{哈密顿量}为
\begin{equation}\label{HamCan_eq1}
H = \sum_i \dot q_i p_i - L
\end{equation}
其中 $L$ 为拉格朗日量， $p_i$ 为广义坐标 $q_i$ 的共轭动量（见\autoref{Lagrng_eq13}\upref{Lagrng}）．

当 $L$ 等于系统动能减势能时， 哈密顿量等于系统能量． 证明如下： 将系统看做质点系， 由于 $L = T - V$ 且 $V$ 与 $\dot q$ 无关， 有
\begin{equation}
p_i = \pdv{L}{\dot q_i} = \pdv{\dot q_i} \sum_j \frac12 m_j \dot{\bvec r}_j^2
= \sum_j m_j \dot{\bvec r}_j \pdv{\dot{\bvec r}_j}{\dot q_i}
= \sum_j m_j \dot{\bvec r}_j  \pdv{\bvec r_j}{q_i}
\end{equation}
其中最后一步利用了\autoref{dAlbt_eq27}\upref{dAlbt}． 所以\autoref{HamCan_eq1} 中的求和项为
\begin{equation}
 \sum_i \dot q_i p_i = \sum_j m_j \dot{\bvec r}_j \sum_i \pdv{\bvec r_j}{q_i}\dv{q_i}{t}
= \sum_j m_j \dot{\bvec r}_j^2 = 2T
\end{equation}
其中第二步用到了 $r(q_1(t), q_2(t) \dots)$ 的全微分\upref{TDiff}， 注意该函数不能显含 $t$．% 未完成：在哪里解释一下“显含”？
 上式代回\autoref{HamCan_eq1}， 可证明 $H = T + V$ 等于系统总能量． 证毕．

从拉格朗日函数 $L$ 变为哈密顿量 $H$ 的这种变换， 叫做\textbf{拉格朗日变换}．

\subsection{哈密顿正则方程}
\textbf{哈密顿正则方程}是一组以 $N$ 个广义坐标 $q_i$ 和 $N$ 个共轭动量（\autoref{Lagrng_eq13}\upref{Lagrng}） 作为因变量的方程组， 共有 $2N$ 条方程． 与拉格朗日方程相比， 虽然方程的个数增多了， 但是方程却由二阶变为了一阶．

如果把系统的哈密顿量写成广义坐标和广义动量的函数
\begin{equation}
H(q_1,\dots, q_N, p_1,\dots, p_N)
\end{equation}
（注意函数中不能出现 $\dot q_i$）则哈密顿正则方程为
\begin{equation}
\dot q_i = \pdv{H}{p_i}
\qquad
\dot p_i = -\pdv{H}{q_i}
\qquad
(i = 1\dots N)
\end{equation}
可见在方程中， $q_i$ 和 $p_i$ 是对称的， 具有同样的地位．

\begin{example}{直角坐标系中的质点运动}
直角坐标系中一个质点的拉格朗日量为 $L = m(\dot x^2 + \dot y^2 + \dot z^2)/2 - V$， 共轭动量就是通常定义的动量（用 $x_1,x_2,x_3$ 表示 $x, y, z$）
\begin{equation}
p_{x_i} = \pdv{L}{\dot x_i} = m\dot x_i
\end{equation}
哈密顿量等于总能量（注意要写成 $x_i$ 和 $p_{x_i}$ 的函数， 不能含有 $\dot x_i$）为
\begin{equation}
H = \sum_i \frac{p_{x_i}^2}{2m} + V
\end{equation}
代入哈密顿方程得
\begin{equation}
\dot x_i = \frac{p_{x_i}}{m}
\qquad
\dot p_{x_i} = -\pdv{V}{x_i}
\qquad (i = 1,2,3)
\end{equation}
显然上式的第一条是（普通）动量与速度的关系， 第二条则是牛顿第二定律．
\end{example}

\subsection{推导}
对\autoref{HamCan_eq1} 全微分， 有
\begin{equation}\label{HamCan_eq9}
\dd{H} = \sum_i \dot q_i \dd{p_i} + \sum_i p_i \dd{\dot q_i} - \dd{L}
\end{equation}
对拉格朗日量全微分， 有
\begin{equation}
\dd{L} = \sum_i \pdv{L}{q_i}\dd{q_i} + \sum_i \pdv{L}{\dot q_i}\dd{\dot q_i} + \pdv{L}{t}
\end{equation}
将拉格朗日方程\autoref{Lagrng_eq1}\upref{Lagrng} 的右边和广义动量的定义\autoref{Lagrng_eq13}\upref{Lagrng} 代入上式， 得
\begin{equation}
\dd{L} = \sum_i \dot p_i\dd{q_i} + \sum_i p_i\dd{\dot q_i} + \pdv{L}{t}
\end{equation}
代入\autoref{HamCan_eq9}， 得
\begin{equation}
\dd{H} = - \sum_i \dot p_i \dd{q_i} + \sum_i \dot q_i \dd{p_i}  - \pdv{L}{t}
\end{equation}
由于 $H$ 是 $p_i, q_i, t$ 的函数， 其全微分为 
\begin{equation}
\dd{H} = \sum_i \pdv{H}{q_i}\dd{q_i} + \sum_i \pdv{H}{p_i}\dd{p_i} + \pdv{H}{t}
\end{equation}
最后， 对比以上两式可得哈密顿正则方程， 以及
\begin{equation}
\pdv{H}{t} = - \pdv{L}{t}
\end{equation}
