%球坐标与直角坐标的转换
% 坐标系|球坐标系|直角坐标系|矢量

\pentry{球坐标系的定义\upref{Sph}}

\subsection{结论}
根据球坐标的定义，可得两种坐标之间的变换关系
\begin{equation}\label{SphCar_eq1}
\begin{cases}
x = r\sin \theta \cos \phi \\
y = r\sin \theta \sin \phi \\
z = r\cos \theta 
\end{cases}
\end{equation}
\begin{equation}\label{SphCar_eq2}
\leftgroup{
r &= \sqrt {x^2 + y^2 + z^2} \\
\theta  &= \arccos \frac{z}{\sqrt{x^2 + y^2 + z^2} }\\
\phi  &= \Arctan(y, x)
}\end{equation}
以及两组基底之间的变换关系
\begin{equation}\label{SphCar_eq3}
\begin{cases}
\uvec r = \sin\theta\cos\phi\,\uvec x + \sin\theta\sin\phi\,\uvec y + \cos\theta\,\uvec z\\
\uvec \theta = \cos\theta\cos\phi\,\uvec x + \cos\theta\sin\phi\,\uvec y - \sin\theta\,\uvec z\\
\uvec \phi =  - \sin\phi\,\uvec x + \cos\phi\,\uvec y
\end{cases}
\end{equation}
\begin{equation}\label{SphCar_eq4}
\begin{cases}
\uvec x = \sin \theta \cos \phi \,\uvec r + \cos \theta \cos \phi \,\uvec \theta  - \sin \phi \,\uvec \phi \\
\uvec y = \sin \theta \sin \phi \,\uvec r + \cos \theta \sin \phi \,\uvec \theta  + \cos \phi \,\uvec \phi \\
\uvec z = \cos \theta \,\uvec r - \sin \theta \,\uvec \theta
\end{cases}
\end{equation}

\subsection{推导}
把空间中一点 $P$ 的位矢 $r \,\uvec r$ 分解为垂直于 $xy$ 平面的分量 $z = r\cos \theta $ 和 $xy$ 平面的分量 $r\sin \theta $． 后者又可以进而分解成 $x$ 分量 和 $y$ 分量  $x = r\sin \theta \cos \phi$，  $y = r\sin \theta \sin \phi$， 这就得到了\autoref{SphCar_eq1}．

在直角坐标系中， 有 $r = \sqrt {x^2 + y^2 + z^2}$， 代入\autoref{SphCar_eq1} 中的三条关系，就可以很容易解出\autoref{SphCar_eq2} 中的三条关系．

现在推导变换关系（\autoref{SphCar_eq3}）．由于 $\uvec r,\uvec \theta ,\uvec \phi $ 都是关于 $(r, \theta, \phi)$ 的函数，所以在考察一点 $(r, \theta, \phi)$ 时， $\uvec r$ 的球坐标是 $(1, \theta, \phi)$，  根据\autoref{SphCar_eq1} 变换到直角坐标为
\begin{equation}
(\sin \theta \cos \phi,\,\sin \theta \sin \phi,\,\cos \theta)
\end{equation}
写成矢量的形式，就是
 \begin{equation}
\uvec r = \sin \theta \cos \phi \,\uvec x + \sin \theta \sin \phi \,\uvec y + \cos \theta \,\uvec z
\end{equation}
至于\autoref{SphCar_eq3} 的第二条式子，在同一个球坐标 $(r,\theta ,\phi)$ 处， $\uvec \theta $ 的球坐标为 $(1, \theta + \pi /2, \phi)$， 根据\autoref{SphCar_eq1} 变换到直角坐标再化简就得到直角坐标和对应的矢量形式为
\begin{equation}
(\cos \theta \cos \phi ,\,\cos \theta \sin \phi , \,- \sin \theta)
\end{equation}
\begin{equation}
\uvec \theta  = \cos \theta \cos \phi \,\uvec x + \cos \theta \sin \phi \,\uvec y - \sin \theta \,\uvec z
\end{equation}
同理，在同一点 $(r, \theta, \phi)$ 处， $\uvec \phi $ 的球坐标为 $(1, \pi /2, \phi + \pi /2)$，  得到第三条式子．

下面推导变换\autoref{SphCar_eq4}． 由于已经知道了变换\autoref{SphCar_eq3}， 且直角坐标系和球坐标系中的基底都是单位正交基，所以直接把变换\autoref{SphCar_eq3} 中的系数写成 $3 \times 3$ 的矩阵形式，再转置 % 未完成： 矩阵转置
即可得到变换\autoref{SphCar_eq4} 中的系数矩阵．% 未完成： 正交基底变换，正交矩阵 等

