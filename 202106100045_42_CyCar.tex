% 柱坐标与直角坐标的转换
% 柱坐标|直角坐标|转换

\begin{issues}
\issueDraft
\end{issues}

\pentry{柱坐标系\upref{Cylin}，四象限 Arctan 函数\upref{Arctan}}
当我们讨论柱坐标和直角坐标的转换时， 通常令两个原点和 $z$ 轴重合， $\theta = 0$， $z = 0$ 为 $x$ 轴的正方向， $\theta = \pi/2$， $z = 0$ 为 $y$ 轴的正方向． 这时两种坐标之间的变换关系为．
\begin{equation}\label{CyCar_eq1}
\begin{cases}
x = r\cos \theta \\
y = r\sin \theta  \\
z = z 
\end{cases}
\end{equation}

\begin{equation}\label{CyCar_eq2}
\begin{cases}
r = \sqrt{x^2+y^2} \\
\theta = \Arctan(y,x)  \\
z = z 
\end{cases}
\end{equation}
注意根据\autoref{CyCar_eq1} ， 同一个直角坐标可以对应不同的极坐标， 例如将 $\theta$ 增加 $2\pi$ 的整数倍， 直角坐标不变． 但根据\autoref{CyCar_eq2} ， 我们可以找到两种坐标间的一一对应\upref{Set}关系．
\subsection{矢量变换}
两组基底之间的变换关系为
\begin{equation}\label{CyCar_eq3}
\begin{cases}
\uvec r = R_{11}\uvec x + R_{12}\uvec y + R_{13}\uvec z\\
\uvec \theta = R_{21}\uvec x + R_{22}\uvec y + R_{23}\uvec z\\
\uvec z = R_{31}\uvec x + R_{32}\uvec y + R_{33}\uvec z
\end{cases}
\end{equation}
\begin{equation}
\begin{cases}
\uvec x = R_{11} \uvec r + R_{21} \uvec \theta  + R_{31} \uvec z \\
\uvec y = R_{12} \uvec r + R_{22} \uvec \theta  + R_{32} \uvec z \\
\uvec z = R_{13} \uvec r + R_{23} \uvec \theta  + R_{33} \uvec z
\end{cases}
\end{equation}
其中 $\mat R$ 是关于角度 $\theta$ 的三维旋转矩阵\upref{Rot3D}
\begin{equation}
\mat R = \pmat{
    \cos\theta & \sin\theta & 0\\
    -\sin\theta & \cos\theta & 0\\
    0 & 0 & 1
}
\end{equation}

若任意矢量 $\bvec v$ 在直角坐标系和球坐标系中分别表示为
\begin{equation}
\bvec v = v_x \uvec x + v_y \uvec y + v_z \uvec z
\end{equation}
\begin{equation}
\bvec v = v_r \uvec r + v_\theta \uvec \theta + v_z \uvec z
\end{equation}
则坐标变换关系可以用矩阵乘法表示
\begin{equation}
\pmat{v_r \\ v_\theta \\ v_z}
= \mat R \pmat{v_x \\ v_y \\ v_z}
\end{equation}
\begin{equation}
\pmat{v_x \\ v_y \\ v_z}
= \mat R\Tr \pmat{v_r \\ v_\theta \\ v_z}
\end{equation}
\subsection{推导}
空间中一点 $P$ 的位矢在 $xy$ 平面的分量为 $r$． 其可以进而分解成 $x$ 分量 和 $y$ 分量  $x = r\cos \theta$，  $y = r\sin \theta$， 而 $P$ 垂直分量即为 $z$ ，这就得到了\autoref{CyCar_eq1} ．有了\autoref{CyCar_eq1} 中的三条关系，就可以很容易解出\autoref{CyCar_eq2} 中的三条关系．
现在推导变换关系\autoref{CyCar_eq3} ．由于 $\uvec r,\uvec \theta ,\uvec z $ 都是关于 $(r, \theta, z)$ 的函数，所以在考察一点 $(r, \theta, z)$ 时， $\uvec r$ 的柱坐标是 $(\sqrt{1-z^2}, \theta, z)$，  根据\autoref{CyCar_eq1} 变换到直角坐标为
\begin{equation}
(\sqrt{1-z^2}\cos \theta,\,\sqrt{1-z^2}\sin \theta,\,z)
\end{equation}
写成矢量的形式，就是
 \begin{equation}
\uvec r = \sqrt{1-z^2}\cos \theta \,\uvec x + \sin \theta \sin \phi \,\uvec y + \cos \theta \,\uvec z
\end{equation}
至于\autoref{SphCar_eq3} 的第二条式子，在同一个球坐标 $(r,\theta ,\phi)$ 处， $\uvec \theta $ 的球坐标为 $(1, \theta + \pi /2, \phi)$， 根据\autoref{SphCar_eq1} 变换到直角坐标再化简就得到直角坐标和对应的矢量形式为
\begin{equation}
(\cos \theta \cos \phi ,\,\cos \theta \sin \phi , \,- \sin \theta)
\end{equation}
\begin{equation}
\uvec \theta  = \cos \theta \cos \phi \,\uvec x + \cos \theta \sin \phi \,\uvec y - \sin \theta \,\uvec z
\end{equation}
同理可得\autoref{SphCar_eq5}． 将基底变换\autoref{SphCar_eq3} 和\autoref{SphCar_eq4} 分别代入\autoref{SphCar_eq6} 和\autoref{SphCar_eq7} 得坐标变换\autoref{SphCar_eq8} 和\autoref{SphCar_eq9}．
